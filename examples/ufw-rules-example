#!/bin/bash
# =====================================
# CONFIGURATION FIREWALL UFW - SERVEUR DEBIAN
# =====================================
# Usage: chmod +x ufw-rules-example && sudo ./ufw-rules-example

echo "üõ°Ô∏è  Configuration du firewall UFW pour serveur Debian"

# R√©initialiser UFW (optionnel)
# sudo ufw --force reset

# Politique par d√©faut: DENY everything
sudo ufw default deny incoming
sudo ufw default allow outgoing

echo "‚úÖ Politiques par d√©faut configur√©es"

# =====================================
# R√àGLES DE BASE (ESSENTIELLES)
# =====================================

# SSH (CRITIQUE - ne pas oublier!)
sudo ufw allow ssh
# Ou pour un port personnalis√©:
# sudo ufw allow 2222/tcp

echo "‚úÖ SSH autoris√©"

# =====================================
# SERVICES WEB (si n√©cessaire)
# =====================================

# HTTP (Apache/Nginx)
# sudo ufw allow 80/tcp

# HTTPS (Apache/Nginx avec SSL)
# sudo ufw allow 443/tcp

# =====================================
# BASES DE DONN√âES (acc√®s local uniquement)
# =====================================

# MySQL/MariaDB (depuis le r√©seau local seulement)
# sudo ufw allow from 192.168.1.0/24 to any port 3306

# PostgreSQL (depuis le r√©seau local seulement)
# sudo ufw allow from 192.168.1.0/24 to any port 5432

# MongoDB (depuis le r√©seau local seulement)
# sudo ufw allow from 192.168.1.0/24 to any port 27017

# =====================================
# APPLICATIONS SP√âCIFIQUES
# =====================================

# Docker (si utilis√©)
# sudo ufw allow 2376/tcp    # Docker daemon
# sudo ufw allow 2377/tcp    # Docker swarm

# Node.js applications
# sudo ufw allow 3000/tcp    # Application de d√©veloppement
# sudo ufw allow 8080/tcp    # Application web alternative

# =====================================
# MONITORING ET ADMINISTRATION
# =====================================

# Zabbix agent
# sudo ufw allow from 192.168.1.0/24 to any port 10050

# SNMP (surveillance r√©seau)
# sudo ufw allow from 192.168.1.0/24 to any port 161

# =====================================
# R√àGLES AVANC√âES
# =====================================

# Limiter les connexions SSH (anti-brute force)
sudo ufw limit ssh
echo "‚úÖ Limitation SSH activ√©e"

# Bloquer une IP sp√©cifique (exemple)
# sudo ufw deny from 192.168.1.100

# Autoriser une IP sp√©cifique pour tous les services
# sudo ufw allow from 192.168.1.50

# =====================================
# R√àGLES PAR INTERFACE (avanc√©)
# =====================================

# Autoriser tout sur loopback (localhost)
sudo ufw allow in on lo
sudo ufw allow out on lo

# Autoriser depuis une interface sp√©cifique
# sudo ufw allow in on enp0s8

# =====================================
# ACTIVATION DU FIREWALL
# =====================================

# Activer UFW
sudo ufw enable

echo "üî• Firewall UFW activ√© et configur√©"
echo ""
echo "üìä √âtat actuel du firewall:"
sudo ufw status verbose

echo ""
echo "üîç Pour voir les r√®gles num√©rot√©es:"
echo "sudo ufw status numbered"
echo ""
echo "üóëÔ∏è  Pour supprimer une r√®gle:"
echo "sudo ufw delete [num√©ro]"
echo ""
echo "‚ö†Ô∏è  IMPORTANT: Testez toujours SSH avant de fermer la session!"
