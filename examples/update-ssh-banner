#!/bin/bash
# =====================================
# SCRIPT DE MISE Ã€ JOUR BANNIÃˆRE SSH
# =====================================
# Usage: chmod +x update-ssh-banner.sh && ./update-ssh-banner.sh

BANNER_FILE="/etc/ssh/banner"
TEMP_BANNER="/tmp/ssh-banner-temp"

echo "ðŸŽ¨ Mise Ã  jour de la banniÃ¨re SSH..."

# CrÃ©er la banniÃ¨re avec les informations actuelles
cat > "$TEMP_BANNER" << EOF
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ðŸ–¥ï¸  SERVEUR $(hostname -s | tr '[:lower:]' '[:upper:]')                          â•‘
â•‘                                                                           â•‘
â•‘                        ðŸ“¡ $(lsb_release -d | cut -f2)                      â•‘
â•‘                                                                           â•‘
â•‘  âš ï¸  ACCÃˆS RESTREINT - UTILISATEURS AUTORISÃ‰S UNIQUEMENT                 â•‘
â•‘                                                                           â•‘
â•‘  ðŸ“‹ Informations systÃ¨me:                                                 â•‘
â•‘  â€¢ IP du serveur: $(ip route get 8.8.8.8 | awk '{print $7; exit}')                                        â•‘
â•‘  â€¢ Kernel: $(uname -r)                            â•‘
â•‘  â€¢ Uptime: $(uptime -p)                           â•‘
â•‘  â€¢ DerniÃ¨re mise Ã  jour: $(date +'%d/%m/%Y Ã  %H:%M')                     â•‘
â•‘                                                                           â•‘
â•‘  ðŸ”§ Scripts d'administration disponibles:                                 â•‘
â•‘  â€¢ server-info.sh      - Informations dÃ©taillÃ©es du systÃ¨me              â•‘
â•‘  â€¢ update-debian.sh    - Mise Ã  jour automatique                         â•‘
â•‘  â€¢ backup-config.sh    - Sauvegarde des configurations                   â•‘
â•‘  â€¢ security-audit.sh   - Audit de sÃ©curitÃ©                               â•‘
â•‘  â€¢ system-cleanup.sh   - Nettoyage du systÃ¨me                            â•‘
â•‘  â€¢ list-scripts.sh     - Liste complÃ¨te des scripts                      â•‘
â•‘                                                                           â•‘
â•‘  ðŸ“ž Support: Type 'list-scripts.sh' pour l'aide                          â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

EOF

# Installer la nouvelle banniÃ¨re
sudo mv "$TEMP_BANNER" "$BANNER_FILE"
sudo chmod 644 "$BANNER_FILE"

# VÃ©rifier que la banniÃ¨re est configurÃ©e dans sshd_config
if ! grep -q "^Banner " /etc/ssh/sshd_config; then
    echo "ðŸ“ Ajout de la banniÃ¨re dans la configuration SSH..."
    echo "Banner $BANNER_FILE" | sudo tee -a /etc/ssh/sshd_config

    # RedÃ©marrer SSH pour appliquer les changements
    echo "ðŸ”„ RedÃ©marrage du service SSH..."
    sudo systemctl restart ssh
fi

echo "âœ… BanniÃ¨re SSH mise Ã  jour avec succÃ¨s!"
echo "ðŸ” Test avec: ssh localhost (puis Ctrl+C pour annuler)"
